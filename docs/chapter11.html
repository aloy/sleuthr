<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Model Checking and Refinement – R Manual for Stat 230</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter12.html" rel="next">
<link href="./chapter10.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter11.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Checking and Refinement</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Manual for Stat 230</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Drawing Statistical Conclusions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Inference Using t-Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple Linear Regression: A Model for the Mean</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">A Closer Look at the Assumptions for Simple Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Inferential Tools for Multiple Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter11.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Checking and Refinement</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Strategies for Variable Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter20.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Logistic Regression for Binary Response Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter21.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Logistic Regression for Binomial Counts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter22.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Poisson Regression for Counts</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#alcohol-metabolism-in-men-and-women" id="toc-alcohol-metabolism-in-men-and-women" class="nav-link active" data-scroll-target="#alcohol-metabolism-in-men-and-women"><span class="header-section-number">8</span> Alcohol metabolism in men and women</a>
  <ul class="collapse">
  <li><a href="#data-coding-summary-statistics-and-graphical-display" id="toc-data-coding-summary-statistics-and-graphical-display" class="nav-link" data-scroll-target="#data-coding-summary-statistics-and-graphical-display"><span class="header-section-number">8.1</span> Data coding, summary statistics and graphical display</a></li>
  <li><a href="#multiple-regression" id="toc-multiple-regression" class="nav-link" data-scroll-target="#multiple-regression"><span class="header-section-number">8.2</span> Multiple regression</a></li>
  <li><a href="#refining-the-model" id="toc-refining-the-model" class="nav-link" data-scroll-target="#refining-the-model"><span class="header-section-number">8.3</span> Refining the Model</a></li>
  </ul></li>
  <li><a href="#blood-brain-barrier" id="toc-blood-brain-barrier" class="nav-link" data-scroll-target="#blood-brain-barrier"><span class="header-section-number">9</span> Blood brain barrier</a>
  <ul class="collapse">
  <li><a href="#data-coding-and-summary-statistics" id="toc-data-coding-and-summary-statistics" class="nav-link" data-scroll-target="#data-coding-and-summary-statistics"><span class="header-section-number">9.1</span> Data coding and summary statistics</a></li>
  <li><a href="#graphical-presentation" id="toc-graphical-presentation" class="nav-link" data-scroll-target="#graphical-presentation"><span class="header-section-number">9.2</span> Graphical presentation</a></li>
  <li><a href="#multiple-regression-1" id="toc-multiple-regression-1" class="nav-link" data-scroll-target="#multiple-regression-1"><span class="header-section-number">9.3</span> Multiple regression</a></li>
  <li><a href="#refining-the-model-1" id="toc-refining-the-model-1" class="nav-link" data-scroll-target="#refining-the-model-1"><span class="header-section-number">9.4</span> Refining the model</a></li>
  </ul></li>
  <li><a href="#partial-residual-plots" id="toc-partial-residual-plots" class="nav-link" data-scroll-target="#partial-residual-plots"><span class="header-section-number">10</span> Partial residual plots</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Checking and Refinement</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter we need to load the following packages (remember, you will need to install packages you have never used before if you are using your own computer).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggformula) <span class="co"># graphics</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Sleuth3)   <span class="co"># Sleuth data sets</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="co"># extract pieces of lm output</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra) <span class="co"># arrange multiple plots on a page</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) <span class="co"># tables to display/compare models</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)       <span class="co"># easy diagnostic plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also set some options to improve legibility of graphs and output.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># display four significant digits by default and no significance stars</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">show.signif.stars =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="alcohol-metabolism-in-men-and-women" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Alcohol metabolism in men and women</h1>
<p>How do men and women metabolize alcohol? This is the question addressed in case study 11.1 in <em>Sleuth</em>.</p>
<section id="data-coding-summary-statistics-and-graphical-display" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="data-coding-summary-statistics-and-graphical-display"><span class="header-section-number">8.1</span> Data coding, summary statistics and graphical display</h2>
<p>We begin by loading the data and summarizing the variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(case1101)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Subject         Metabol         Gastric         Sex              Alcohol  
 Min.   : 1.00   Min.   : 0.10   Min.   :0.80   Female:18   Alcoholic    : 8  
 1st Qu.: 8.75   1st Qu.: 0.60   1st Qu.:1.20   Male  :14   Non-alcoholic:24  
 Median :16.50   Median : 1.70   Median :1.60                                 
 Mean   :16.50   Mean   : 2.42   Mean   :1.86                                 
 3rd Qu.:24.25   3rd Qu.: 2.92   3rd Qu.:2.20                                 
 Max.   :32.00   Max.   :12.30   Max.   :5.20                                 </code></pre>
</div>
</div>
<p>A total of 32 volunteers were included in this data. There were 18 females and 14 males, as recorded on Display 11.1 (page 311 of the Sleuth).</p>
<p>The following is a version of Display 11.2 (page 312):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(Metabol <span class="sc">~</span> Gastric, <span class="at">data =</span> case1101, <span class="at">shape =</span> <span class="sc">~</span>Alcohol, <span class="at">color =</span> <span class="sc">~</span>Sex) <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Gastric AD activity ("</span>, mu, <span class="st">"mol/min/g of tissue)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"First-pass metabolism (mmol/liter-hour)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>), <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>The above plot uses shape and color to encode different information, which can be harder to read than necessary. A better idea is to use color and shape to encode the same information and to use faceting to introduce another variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">|</span> Sex, <span class="at">data =</span> case1101, <span class="at">shape =</span> <span class="sc">~</span>Alcohol, <span class="at">color =</span> <span class="sc">~</span>Alcohol) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Gastric AD activity ("</span>, mu, <span class="st">"mol/min/g of tissue)"</span>, <span class="at">sep =</span> <span class="st">""</span>)), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="st">"First-pass metabolism (mmol/liter-hour)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Dark2"</span>), <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiple-regression" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="multiple-regression"><span class="header-section-number">8.2</span> Multiple regression</h2>
<p>Next, we fit the full model (including all pairwise interactions) for estimating metabolism given a subjects gastric AD activity, whether they are alcoholic, and their sex. This first model is summarized on page 321 (Display 11.9). Notice that the baseline levels of <code>Sex</code> and <code>Alcohol</code> are redefined prior to modeling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>case1101 <span class="ot">&lt;-</span> case1101 <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sex =</span> <span class="fu">factor</span>(Sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Alcohol =</span> <span class="fu">factor</span>(Alcohol, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Non-alcoholic"</span>, <span class="st">"Alcoholic"</span>)))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>case1_mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">*</span> Sex <span class="sc">*</span> Alcohol, <span class="at">data =</span> case1101)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(case1_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term                               estimate std.error statistic     p.value
  &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 (Intercept)                           -1.66     1.00     -1.66  0.110      
2 Gastric                                2.51     0.343     7.32  0.000000146
3 SexFemale                              1.47     1.33      1.10  0.282      
4 AlcoholAlcoholic                       2.55     1.95      1.31  0.202      
5 Gastric:SexFemale                     -1.67     0.620    -2.70  0.0126     
6 Gastric:AlcoholAlcoholic              -1.46     1.05     -1.39  0.179      
7 SexFemale:AlcoholAlcoholic            -2.25     4.39     -0.512 0.613      
8 Gastric:SexFemale:AlcoholAlcoholic     1.20     3.00      0.400 0.693      </code></pre>
</div>
</div>
<p>Notice also that the asterisk (<code>*</code>) is used to code interactions in R. When an interaction is specified in this way, R will fit all of the terms involved in the largest interaction. For example, in the above model formula we specified <code>Gastric * Sex * Alcohol</code> which resulted in all of the main effects (<code>Gastric</code> <code>Sex</code>, <code>Alcohol</code>), pairwise interactions (<code>Gastric:Sex</code>, <code>Gastric:Alcohol</code>, and <code>Sex:Alcohol</code>), and the triplet (<code>Gastric:Sex:Alcohol</code>) being included. The above model can be fit using the equivalent “long-hand” formula:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>case1_mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">+</span> Sex <span class="sc">+</span> Alcohol <span class="sc">+</span> Gastric <span class="sc">*</span> Sex <span class="sc">+</span> Sex <span class="sc">*</span> Alcohol <span class="sc">+</span> Gastric <span class="sc">*</span> Alcohol <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   Gastric <span class="sc">*</span> Sex <span class="sc">*</span> Alcohol, <span class="at">data =</span> case1101)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(case1_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term                               estimate std.error statistic     p.value
  &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 (Intercept)                           -1.66     1.00     -1.66  0.110      
2 Gastric                                2.51     0.343     7.32  0.000000146
3 SexFemale                              1.47     1.33      1.10  0.282      
4 AlcoholAlcoholic                       2.55     1.95      1.31  0.202      
5 Gastric:SexFemale                     -1.67     0.620    -2.70  0.0126     
6 SexFemale:AlcoholAlcoholic            -2.25     4.39     -0.512 0.613      
7 Gastric:AlcoholAlcoholic              -1.46     1.05     -1.39  0.179      
8 Gastric:SexFemale:AlcoholAlcoholic     1.20     3.00      0.400 0.693      </code></pre>
</div>
</div>
<p>Having fit the full model, we calculate a number of model diagnostics, including leverage, studentized (i.e.&nbsp;standardized) residuals, and Cook’s distance (pages 325-327).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>case1_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(case1_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The 31st row of this augmented data frame is shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>case1_aug[<span class="dv">31</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
  Metabol Gastric Sex   Alcohol       .fitted .resid  .hat .sigma .cooksd .std.resid
    &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;           &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
1     9.5     5.2 Male  Non-alcoholic    11.4  -1.91 0.601   1.11    1.10      -2.41</code></pre>
</div>
</div>
<p>Note that in this augmented data frame leverage is called <code>.hat</code>, studentized (standardized) residuals are called <code>.std.resid</code>, and Cook’s distances are called <code>.cooksd</code>.</p>
<p>It is often easier to digest these values visually. The <code>infIndexPlot()</code> command in the <code>car</code> package allows us to do this just as in Display 11.12 (page 327):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">infIndexPlot</span>(case1_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Note: the “Bonferroni p-value” panel in the plot is displaying the results for a test of outlierhood.</p>
<p>As pointed out in <em>Sleuth</em>, cases 31 and 32 have substantially larger studentized residuals than the other observations. Interestingly, observations 1 and 23 stand out more than 31 and 32 in our version of the index plots.</p>
<p>The authors of <em>Sleuth</em> refit the model without observations 31 and 32.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>case1_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">+</span> Sex <span class="sc">+</span> Alcohol <span class="sc">+</span> Gastric <span class="sc">*</span> Sex <span class="sc">+</span> Sex <span class="sc">*</span> Alcohol <span class="sc">+</span> Gastric <span class="sc">*</span> Alcohol <span class="sc">+</span> Gastric <span class="sc">*</span> Sex <span class="sc">*</span> Alcohol, <span class="at">data =</span> case1101, <span class="at">subset =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">32</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A table comparing the model coefficients with and without cases 21 and 32 is shown below:</p>
</section>
<section id="refining-the-model" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="refining-the-model"><span class="header-section-number">8.3</span> Refining the Model</h2>
<p>This section addresses the process of refining the model. First, we use an extra-sums-of-square F-test to determine whether the terms involving alcoholism can be removed from the full model, as shown in Display 11.13 (page 329).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>case1_mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">*</span> Sex, <span class="at">data =</span> case1101, <span class="at">subset =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">32</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(case1_mod3, case1_mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Metabol ~ Gastric * Sex
Model 2: Metabol ~ Gastric + Sex + Alcohol + Gastric * Sex + Sex * Alcohol + 
    Gastric * Alcohol + Gastric * Sex * Alcohol
  Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)
1     26 20.2                         
2     22 19.5  4      0.74 0.21   0.93</code></pre>
</div>
</div>
<p>As noted in <em>Sleuth</em> there is no evidence of an alcoholism effect, so we can utilize the smaller model. There are no issue revealed by inspection of the residual plots. Further, revisiting the case influence diagnostics, we now see that no observations stand out. (Note: the issues with cases 1 and 23 previously seen were due to the fact that there were so few alcoholics in the data set, so it was “easy” for points to be potentially influential due to data sparsity.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residualPlots</span>(case1_mod3, <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">tests =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">infIndexPlot</span>(case1_mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Next, we assess a model without an intercept, which is scientifically plausible and summarized in Display 11.14 (page 329).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>case1_mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Metabol <span class="sc">~</span> Gastric <span class="sc">+</span> Gastric<span class="sc">:</span>Sex <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> case1101, <span class="at">subset =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">31</span>, <span class="dv">32</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(case1_mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term              estimate std.error statistic     p.value
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
1 Gastric              0.726     0.121      5.99  0.00000187
2 Gastric:SexMale      0.873     0.174      5.02  0.0000263 
3 Gastric:SexFemale   NA        NA         NA    NA         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(case1_mod4, case1_mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Metabol ~ Gastric + Gastric:Sex - 1
Model 2: Metabol ~ Gastric * Sex
  Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)
1     28 20.3                         
2     26 20.2  2     0.094 0.06   0.94</code></pre>
</div>
</div>
<p>Note that the “Summary of Statistical Findings” section (page 312) is based on this final model.</p>
</section>
</section>
<section id="blood-brain-barrier" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Blood brain barrier</h1>
<p>Neuroscientists working to better understand the blood brain barrier have infused rats with cells to induce brain tumors. This is the topic addressed in case study 11.2 in the <em>Sleuth</em>.</p>
<section id="data-coding-and-summary-statistics" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="data-coding-and-summary-statistics"><span class="header-section-number">9.1</span> Data coding and summary statistics</h2>
<p>We begin by loading the data, performing transformations where needed, and summarizing the variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(case1102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Brain"     "Liver"     "Time"      "Treatment" "Days"      "Sex"       "Weight"   
[8] "Loss"      "Tumor"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>case1102 <span class="ot">&lt;-</span> case1102 <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> Brain<span class="sc">/</span>Liver,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">SAC =</span> <span class="fu">as.factor</span>(Time),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">logliver =</span> <span class="fu">log</span>(Liver),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">logbrain =</span> <span class="fu">log</span>(Brain),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">logy =</span> <span class="fu">log</span>(Brain<span class="sc">/</span>Liver),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">logtime =</span> <span class="fu">log</span>(Time),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Sex =</span> <span class="fu">relevel</span>(Sex, <span class="at">ref =</span> <span class="st">"Male"</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Treat =</span> <span class="fu">relevel</span>(Treatment, <span class="at">ref =</span> <span class="st">"NS"</span>)) <span class="co"># make "NS" referenec level</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(case1102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Brain            Liver              Time       Treatment      Days        Sex    
 Min.   :  1334   Min.   :    928   Min.   : 0.50   BD:17     Min.   : 9   Male  : 8  
 1st Qu.: 19281   1st Qu.:  16210   1st Qu.: 1.12   NS:17     1st Qu.:10   Female:26  
 Median : 32572   Median : 643965   Median : 3.00             Median :10              
 Mean   : 39965   Mean   : 668776   Mean   :23.51             Mean   :10              
 3rd Qu.: 50654   3rd Qu.:1318557   3rd Qu.:24.00             3rd Qu.:10              
 Max.   :123730   Max.   :1790863   Max.   :72.00             Max.   :11              
     Weight         Loss           Tumor           Y           SAC       logliver    
 Min.   :184   Min.   :-4.90   Min.   : 25   Min.   :0.0103   0.5:9   Min.   : 6.83  
 1st Qu.:225   1st Qu.: 1.20   1st Qu.:136   1st Qu.:0.0337   3  :9   1st Qu.: 9.69  
 Median :240   Median : 3.95   Median :166   Median :0.1193   24 :8   Median :13.37  
 Mean   :242   Mean   : 3.64   Mean   :183   Mean   :1.5036   72 :8   Mean   :11.61  
 3rd Qu.:259   3rd Qu.: 5.97   3rd Qu.:223   3rd Qu.:1.9516           3rd Qu.:14.09  
 Max.   :298   Max.   :12.80   Max.   :484   Max.   :8.5454           Max.   :14.40  
    logbrain          logy           logtime       Treat  
 Min.   : 7.20   Min.   :-4.578   Min.   :-0.693   NS:17  
 1st Qu.: 9.86   1st Qu.:-3.390   1st Qu.:-0.245   BD:17  
 Median :10.39   Median :-2.126   Median : 1.099          
 Mean   :10.23   Mean   :-1.389   Mean   : 1.861          
 3rd Qu.:10.83   3rd Qu.: 0.668   3rd Qu.: 3.178          
 Max.   :11.73   Max.   : 2.145   Max.   : 4.277          </code></pre>
</div>
</div>
<p>A total of 34 rats were included in this experiment. Each rat was given either the barrier solution (<span class="math inline">\(n = 17\)</span>) or a normal saline solution (<span class="math inline">\(n = 17\)</span>). Then variables of interest were calculated and are displayed in Display 11.4 (page 314 of the <em>Sleuth</em>).</p>
</section>
<section id="graphical-presentation" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="graphical-presentation"><span class="header-section-number">9.2</span> Graphical presentation</h2>
<p>A scatterplot of log ratio (Y) as a function of log time, as shown in Display 11.5 on page 315, is shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(Y <span class="sc">~</span> Time, <span class="at">data =</span> case1102, <span class="at">shape =</span> <span class="sc">~</span>Treat) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_refine</span>(<span class="fu">coord_trans</span>(<span class="at">x =</span> <span class="st">"log10"</span>, <span class="at">y=</span><span class="st">"log10"</span>),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>))) <span class="sc">%&gt;%</span> <span class="co"># 1 = hollow, 16 = filled</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">x =</span> <span class="st">"Sacrifice Time (hours)"</span>, <span class="at">y =</span> <span class="st">"Tumor-to-Liver Concentration Ratio"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>We can also graphically explore relationships between the variables using a scatterplot matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatterplotMatrix</span>(<span class="sc">~</span> logy <span class="sc">+</span> logbrain <span class="sc">+</span> logliver <span class="sc">+</span> Treat <span class="sc">+</span> SAC, <span class="at">smooth =</span> <span class="cn">FALSE</span> , <span class="at">data =</span> case1102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multiple-regression-1" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="multiple-regression-1"><span class="header-section-number">9.3</span> Multiple regression</h2>
<p>First, we fit the model proposed on page 317.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>case2_mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logy <span class="sc">~</span> SAC <span class="sc">*</span> Treat <span class="sc">+</span> Days <span class="sc">+</span> Sex <span class="sc">+</span> Weight <span class="sc">+</span> Loss <span class="sc">+</span> Tumor, <span class="at">data =</span> case1102)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(case2_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 5
   term           estimate std.error statistic  p.value
   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)   -3.84       3.37     -1.14    2.68e- 1
 2 SAC3           1.02       0.400     2.54    1.90e- 2
 3 SAC24          4.34       0.478     9.08    1.03e- 8
 4 SAC72          5.01       0.455    11.0     3.48e-10
 5 TreatBD        0.796      0.379     2.10    4.79e- 2
 6 Days          -0.0370     0.296    -0.125   9.02e- 1
 7 SexFemale     -0.00130    0.373    -0.00347 9.97e- 1
 8 Weight        -0.000558   0.00533  -0.105   9.18e- 1
 9 Loss          -0.0595     0.0304   -1.96    6.37e- 2
10 Tumor          0.00155    0.00123   1.26    2.20e- 1
11 SAC3:TreatBD   0.180      0.552     0.326   7.48e- 1
12 SAC24:TreatBD -0.386      0.585    -0.659   5.17e- 1
13 SAC72:TreatBD  0.379      0.569     0.666   5.13e- 1</code></pre>
</div>
</div>
<p>We can then display a residual plot to assess the fit of the above model. This is provided in Display 11.6 (page 318). Note that <code>id.n</code> prints the row numbers for the <code>n</code> largest residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residualPlot</span>(case2_mod1, <span class="at">id =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Next, we can use partial residual plots to examine the effects of the covariates (Sex and Days) after the design variables (sacrifice time and treatment) have been accounted for. To do this it is tempting to use partial residual plots, however, as defined in <em>Sleuth</em>, partial residuals cannot be calculated for terms involved in interactions, since it is impossible to isolate the effect of the term after accounting for the others (namely, the term(s) involved in the interaction(s)). To reproduce Display 11.16, we would need to determine exactly what the author’s calculated. (My guess is that they fit the model without interactions if they followed their own definition.) See the last section of this packet for a reproduction of Display 11.15.</p>
</section>
<section id="refining-the-model-1" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="refining-the-model-1"><span class="header-section-number">9.4</span> Refining the model</h2>
<p>Finally, we fit a refined model. These results can be found in Display 11.17 (page 334).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>case2_mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(logy <span class="sc">~</span> SAC <span class="sc">+</span> Treat, <span class="at">data =</span> case1102)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(case2_mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)   -4.30      0.205    -21.0  4.30e-19
2 SAC3           1.13      0.252      4.50 1.01e- 4
3 SAC24          4.26      0.259     16.4  3.13e-16
4 SAC72          5.15      0.259     19.9  1.90e-18
5 TreatBD        0.797     0.183      4.35 1.55e- 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(case2_mod2, case2_mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: logy ~ SAC + Treat
Model 2: logy ~ SAC * Treat + Days + Sex + Weight + Loss + Tumor
  Res.Df  RSS Df Sum of Sq    F Pr(&gt;F)
1     29 8.23                         
2     21 6.68  8      1.55 0.61   0.76</code></pre>
</div>
</div>
</section>
</section>
<section id="partial-residual-plots" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Partial residual plots</h1>
<p>To show the capabilities of <code>crPlot()</code>, consider the log brain weight vs.&nbsp;log gestation example that was revisited on pages 330-331. The partial residual plot from Display 11.15 is created by the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lgest_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Brain) <span class="sc">~</span> <span class="fu">log</span>(Body) <span class="sc">+</span> <span class="fu">log</span>(Gestation), <span class="at">data =</span> case0902)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crPlot</span>(lgest_mod, <span class="at">variable =</span> <span class="st">"log(Gestation)"</span>, <span class="at">smooth =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="chapter11_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>As mentioned in <em>Sleuth</em>, the partial residual plot reveals that there is still a linear association between log brain weight and log gestation after account for the effect of log body weight.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter10.html" class="pagination-link" aria-label="Inferential Tools for Multiple Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Inferential Tools for Multiple Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter12.html" class="pagination-link" aria-label="Strategies for Variable Selection">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Strategies for Variable Selection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>